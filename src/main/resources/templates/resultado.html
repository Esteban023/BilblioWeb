<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8" />
  <link rel="stylesheet" th:href="@{/css/resultado.css}" />
</head>

<body>
<div th:replace="~{fragmentos :: top-bar}"></div>
<div class="container">
  <div class="home-page">
    <div class="main-content">
      <div th:replace="~{fragmentos :: profile}"></div>
      <div class="search">
        <div class="nav-content">
          <form class="nav" th:action="@{/buscar}" method="post">
            <input type="text" name="palabraClave" placeholder="Buscar en todos los recursos del catalogo" th:value="${palabra}">
            <button class="vector-wrapper" type="submit"><img class="vector" th:src="@{/img/busqueda.svg}" /></button>
            <div class="voice"><img class="img" th:src="@{/img/microfono.svg}" /></div>
          </form>
        </div>
        <div class="nav-result-wrapper">
          <div class="nav-result">
            <div class="div-wrapper"><div class="text-wrapper"><span th:text="${resultados.size()}"></span>  Resultados</div></div>
            <div class="div"><p class="p">Resultados de búsqueda para “<span th:text="${palabra}"></span>”</p></div>
          </div>
        </div>
        <div class="result-content" >

          <div class="result" th:each="resultado, iterStat : ${resultados}">
            <div class="numero"><div class="text-wrapper-2" th:text="${iterStat.count} + ' .'"></div></div>
            <div class="contenido">
              <a class="text-wrapper-3" th:text="${resultado.titulo}" th:href="@{/buscar/{titulo}(titulo = ${resultado.titulo})}"></a>
              <p class="text-wrapper-4" th:text="${resultado.getAutoresString()}"></p>
              <div class="icon-text">
                <div class="vector-wrapper"><img class="vector-2" th:src="@{/img/libros.svg}" /></div>
                <div class="frame-2"><div class="text-wrapper-5" th:text="${resultado.tipoDePublicacion}"></div></div>
              </div>
              <div class="text-wrapper-6">Ejemplares: 2</div>
            </div>
          </div>

        </div>
      </div>
      <footer th:replace="~{fragmentos :: footer}"></footer>
    </div>

  </div>
  <div th:replace="~{fragmentos :: side-bar}"></div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      // 1. Restaurar posición al cargar
      const savedScroll = sessionStorage.getItem('resultsScrollPosition');
      if (savedScroll !== null) {
          setTimeout(function() {
              window.scrollTo(0, parseInt(savedScroll));
              sessionStorage.removeItem('resultsScrollPosition');
          }, 100);
      }

      // 2. Manejar el botón de volver con event delegation
      document.body.addEventListener('click', function(e) {
          if (e.target.closest('a.back')) {
              e.preventDefault();
              sessionStorage.setItem('resultsScrollPosition', window.pageYOffset.toString());
              window.history.back();
          }
      });

      // 3. Manejar clicks en recursos
      const resultLinks = document.querySelectorAll('a.text-wrapper-3');
      resultLinks.forEach(function(link) {
          link.addEventListener('click', function() {
              sessionStorage.setItem('resultsScrollPosition', window.pageYOffset.toString());
          });
      });
  });
</script>
</body>
</html>